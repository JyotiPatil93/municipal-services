{"version":3,"sources":["../../src/api/getDependentEligibilityForBenefit.js"],"names":["asyncHandler","require","api","post","res","next","body","RequestInfo","ProcessInstances","tenantId","mdms","dependents","i","length","dependent","eligibility","isEligibleForGratuity","isEligibleForPension","response","ResponseInfo","Dependents","json"],"mappings":";;;;;;;;;;;;;;AAAA;;AACA;;AACA;;;;AACA;;AACA;;;;AACA;;;;AACA;;;;AACA;;;;AACA;;;;;;AACA,IAAMA,eAAeC,QAAQ,uBAAR,CAArB;;kBAGe,YAAM;AACnB,MAAIC,MAAM,sBAAV;AACAA,MAAIC,IAAJ,CACE,qCADF,EAEEH;AAAA,wFAAa,wBAAiBI,GAAjB,EAAsBC,IAAtB;AAAA,UAASC,IAAT,SAASA,IAAT;;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,qBAGI,wBAASA,KAAKC,WAAd,EAA2BD,KAAKE,gBAAL,CAAsB,CAAtB,EAAyBC,QAApD,CAHJ;;AAAA;AAGTC,kBAHS;AAITC,wBAJS,GAIEL,KAAKE,gBAAL,CAAsB,CAAtB,EAAyBG,UAJ3B;;;AAMb,mBAASC,CAAT,GAAa,CAAb,EAAgBA,IAAID,WAAWE,MAA/B,EAAuCD,GAAvC,EAA4C;AACtCE,yBADsC,GAC5BH,WAAWC,CAAX,CAD4B;AAEtCG,2BAFsC,GAE1B,IAF0B;;AAG1CA,8BAAY,4DAAmCD,SAAnC,EAA6CJ,IAA7C,CAAZ;AACAC,2BAAWC,CAAX,EAAcI,qBAAd,GAAoCD,eAAa,MAAb,GAAoB,IAApB,GAAyB,KAA7D;AACD;;AAIQH,eAfI,GAeA,CAfA;;AAAA;AAAA,oBAeGA,IAAID,WAAWE,MAflB;AAAA;AAAA;AAAA;;AAgBPE,0BAhBO,GAgBK,IAhBL;;AAAA,mBAiBRJ,WAAWC,CAAX,EAAcI,qBAjBN;AAAA;AAAA;AAAA;;AAkBLF,wBAlBK,GAkBKH,WAAWC,CAAX,CAlBL;;AAmBTG,6BAAY,2DAAkCD,UAAlC,EAA4CJ,IAA5C,EAAiDC,UAAjD,CAAZ;;AAnBS,oBAoBNI,gBAAa,MApBP;AAAA;AAAA;AAAA;;AAqBPJ,yBAAWC,CAAX,EAAcK,oBAAd,GAAmC,IAAnC;AArBO;;AAAA;AAe0BL,iBAf1B;AAAA;AAAA;;AAAA;AA6BTM,sBA7BS,GA6BE;AACbC,8BAAc,sCAA0Bb,KAAKC,WAA/B,EAA4C,IAA5C,CADD;AAEba,4BAAWT;AAFE,eA7BF;;AAiCbP,kBAAIiB,IAAJ,CAASH,QAAT;;AAjCa;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,KAAb;;AAAA;AAAA;AAAA;AAAA,MAFF;AAuCA,SAAOhB,GAAP;AACD,C","file":"getDependentEligibilityForBenefit.js","sourcesContent":["import { Router } from \"express\";\r\nimport { getDependentEligibilityForPension,getDependentEligibilityForGratuity} from \"../utils/calculationManager\";\r\nimport envVariables from \"../envVariables\";\r\nimport { requestInfoToResponseInfo} from \"../utils\";\r\nimport mdmsData from \"../utils/mdmsData\";\r\nimport isEmpty from \"lodash/isEmpty\";\r\nimport set from \"lodash/set\";\r\nimport get from \"lodash/get\";\r\nimport filter from \"lodash/filter\";\r\nconst asyncHandler = require(\"express-async-handler\");\r\n\r\n\r\nexport default () => {\r\n  let api = Router();\r\n  api.post(\r\n    \"/_getDependentEligibilityForBenefit\",\r\n    asyncHandler(async ({ body }, res, next) => {\r\n         \r\n\r\n    let mdms = await mdmsData(body.RequestInfo, body.ProcessInstances[0].tenantId);   \r\n    let dependents=body.ProcessInstances[0].dependents; \r\n    \r\n    for (var i = 0; i < dependents.length; i++) { \r\n      let dependent=dependents[i];\r\n      let eligibility=null;\r\n      eligibility=getDependentEligibilityForGratuity(dependent,mdms);\r\n      dependents[i].isEligibleForGratuity=eligibility==\"TRUE\"?true:false;     \r\n    }\r\n\r\n    \r\n\r\n    for (var i = 0; i < dependents.length; i++) {   \r\n      let eligibility=null;    \r\n      if(dependents[i].isEligibleForGratuity){\r\n        let dependent=dependents[i];\r\n        eligibility=getDependentEligibilityForPension(dependent,mdms,dependents);\r\n        if(eligibility==\"TRUE\"){\r\n          dependents[i].isEligibleForPension=true;\r\n          break;\r\n        }\r\n      }      \r\n    }\r\n\r\n    \r\n    \r\n    let response = {        \r\n      ResponseInfo: requestInfoToResponseInfo(body.RequestInfo, true),\r\n      Dependents:dependents\r\n    };\r\n    res.json(response);\r\n           \r\n    })\r\n  );\r\n  return api;\r\n};\r\n\r\n\r\n"]}