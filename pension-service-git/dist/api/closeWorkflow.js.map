{"version":3,"sources":["../../src/api/closeWorkflow.js"],"names":["asyncHandler","require","config","db","api","post","res","next","body","payloads","action","topic","RequestInfo","ProcessInstances","tenantId","businessId","workflowSearchResponse","logger","debug","JSON","stringify","businessService","isContingentBillGenerated","envVariables","EGOV_PENSION_WORKFLOW_ACTION_CLOSE","EGOV_PENSION_WORKFLOW_ACTION_SEND_BACK","workflowResponse","EGOV_PENSION_RRP_BUSINESS_SERVICE","EGOV_PENSION_DOE_BUSINESS_SERVICE","EGOV_PENSION_DOP_BUSINESS_SERVICE","KAFKA_TOPICS_SAVE_CLOSED","push","messages","producer","send","err","data","response","ResponseInfo","json"],"mappings":";;;;;;;;;;;;;;AAAA;;AACA;;;;AACA;;AACA;;;;AACA;;;;AACA;;AACA;;;;AACA;;;;AACA;;;;AACA;;AAGA;;;;;;AAFA,IAAMA,eAAeC,QAAQ,uBAAR,CAArB;;kBAIe,gBAAoB;AAAA,MAAjBC,MAAiB,QAAjBA,MAAiB;AAAA,MAATC,EAAS,QAATA,EAAS;;AACjC,MAAIC,MAAM,sBAAV;AACAA,MAAIC,IAAJ,CACE,iBADF,EAEEL;AAAA,yFAAa,wBAAiBM,GAAjB,EAAsBC,IAAtB;AAAA,UAASC,IAAT,SAASA,IAAT;AAAA;AAAA;AAAA;AAAA;AAAA;AACPC,sBADO,GACI,EADJ;AAKPC,oBALO,GAKA,EALA;AAMPC,mBANO,GAMD,EANC;AAAA;AAAA,qBAOwB,kCAAsBH,KAAKI,WAA3B,EAAwCJ,KAAKK,gBAAL,CAAsB,CAAtB,EAAyBC,QAAjE,EAA0EN,KAAKK,gBAAL,CAAsB,CAAtB,EAAyBE,UAAnG,CAPxB;;AAAA;AAOPC,oCAPO;;AAQXC,+BAAOC,KAAP,CAAa,wBAAb,EAAuCC,KAAKC,SAAL,CAAeJ,sBAAf,CAAvC;AACA;AACIK,6BAVO,GAUSb,KAAKK,gBAAL,CAAsB,CAAtB,EAAyBQ,eAVlC;AAWPC,uCAXO,GAWmBd,KAAKK,gBAAL,CAAsB,CAAtB,EAAyBS,yBAX5C;;AAYX,kBAAGA,yBAAH,EAA6B;AAC3BZ,yBAAOa,uBAAaC,kCAApB;AACD,eAFD,MAGI;AACFd,yBAAOa,uBAAaE,sCAApB;AACD;AACDjB,mBAAKK,gBAAL,CAAsB,CAAtB,EAAyBH,MAAzB,GAAgCA,MAAhC;AAlBW;AAAA,qBAmBE,iDAAoCF,IAApC,EAAyCQ,sBAAzC,CAnBF;;AAAA;AAmBXR,kBAnBW;AAAA;AAAA,qBAqBgB,2BAAeA,IAAf,CArBhB;;AAAA;AAqBPkB,8BArBO;AAAA,4BAuBJhB,MAvBI;AAAA,8CAwBJa,uBAAaC,kCAxBT,wBAqCJD,uBAAaE,sCArCT;AAAA;;AAAA;AAAA,4BAyBAJ,eAzBA;AAAA,8CA0BAE,uBAAaI,iCA1Bb,wBA6BAJ,uBAAaK,iCA7Bb,wBAgCAL,uBAAaM,iCAhCb;AAAA;;AAAA;AA2BHlB,sBAAOY,uBAAaO,wBAApB;AA3BG;;AAAA;AA8BHnB,sBAAOY,uBAAaO,wBAApB;AA9BG;;AAAA;AAiCHnB,sBAAOY,uBAAaO,wBAApB;AAjCG;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;;AA8CXrB,uBAASsB,IAAT,CAAc;AACZpB,uBAAOA,KADK;AAEZqB,0BAAUb,KAAKC,SAAL,CAAeZ,IAAf;AAFE,eAAd;AAIAyB,iCAASC,IAAT,CAAczB,QAAd,EAAwB,UAAS0B,GAAT,EAAcC,IAAd,EAAoB;AAC1C,oBAAIC,WAAW;AACbC,gCAAc,sCAA0B9B,KAAKI,WAA/B,EAA4C,IAA5C,CADD;AAEbC,oCAAkBL,KAAKK;AAFV,iBAAf;AAIAP,oBAAIiC,IAAJ,CAASF,QAAT;AACD,eAND;;AAlDW;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,KAAb;;AAAA;AAAA;AAAA;AAAA,MAFF;AAgEA,SAAOjC,GAAP;AACD,C","file":"closeWorkflow.js","sourcesContent":["import { Router } from \"express\";\nimport producer from \"../kafka/producer\";\nimport { requestInfoToResponseInfo, createWorkFlow ,searchPensionWorkflow} from \"../utils\";\nimport envVariables from \"../envVariables\";\nimport mdmsData from \"../utils/mdmsData\";\nimport { addUUIDAndAuditDetailsCloseWorkflow } from \"../utils/create\";\nimport isEmpty from \"lodash/isEmpty\";\nimport set from \"lodash/set\";\nimport get from \"lodash/get\";\nimport { intConversion} from \"../utils/search\";\nconst asyncHandler = require(\"express-async-handler\");\n\nimport logger from \"../config/logger\";\n\nexport default ({ config, db }) => {\n  let api = Router();\n  api.post(\n    \"/_closeWorkflow\",\n    asyncHandler(async ({ body }, res, next) => {\n      let payloads = [];\n    \n\n           \n      let action=\"\";\n      let topic=\"\";\n      let workflowSearchResponse = await searchPensionWorkflow(body.RequestInfo, body.ProcessInstances[0].tenantId,body.ProcessInstances[0].businessId);      \n      logger.debug(\"workflowSearchResponse\", JSON.stringify(workflowSearchResponse));\n      //currentState=workflowSearchResponse.ProcessInstances[0].state.state;     \n      let businessService=body.ProcessInstances[0].businessService;\n      let isContingentBillGenerated=body.ProcessInstances[0].isContingentBillGenerated;      \n      if(isContingentBillGenerated){\n        action=envVariables.EGOV_PENSION_WORKFLOW_ACTION_CLOSE;\n      }\n      else{\n        action=envVariables.EGOV_PENSION_WORKFLOW_ACTION_SEND_BACK;\n      }\n      body.ProcessInstances[0].action=action;\n      body = await addUUIDAndAuditDetailsCloseWorkflow(body,workflowSearchResponse); \n       \n      let workflowResponse=await createWorkFlow(body);\n      \n      switch(action){\n        case envVariables.EGOV_PENSION_WORKFLOW_ACTION_CLOSE: //Close Workflow \n          switch(businessService){    \n            case envVariables.EGOV_PENSION_RRP_BUSINESS_SERVICE:\n              topic= envVariables.KAFKA_TOPICS_SAVE_CLOSED;\n              break;\n            case envVariables.EGOV_PENSION_DOE_BUSINESS_SERVICE:\n              topic= envVariables.KAFKA_TOPICS_SAVE_CLOSED;\n              break;\n            case envVariables.EGOV_PENSION_DOP_BUSINESS_SERVICE:\n              topic= envVariables.KAFKA_TOPICS_SAVE_CLOSED;\n              break;\n          }\n          break;                \n        case envVariables.EGOV_PENSION_WORKFLOW_ACTION_SEND_BACK:\n          break;\n        default:\n          break;\n\n      }     \n      \n         \n\n      payloads.push({\n        topic: topic,\n        messages: JSON.stringify(body)\n      });\n      producer.send(payloads, function(err, data) {\n        let response = {\n          ResponseInfo: requestInfoToResponseInfo(body.RequestInfo, true),\n          ProcessInstances: body.ProcessInstances\n        };\n        res.json(response);\n      });\n      \n\n        \n    })\n  );\n  return api;\n};\n"]}